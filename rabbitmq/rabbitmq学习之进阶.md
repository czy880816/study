# 一、关于消息

mandatory和immediate，这两个参数都有当消息传递过程冲不可达目的地时将消息返回给生产者的功能。RabbitMQ提供的备份交换器可以将未能被交换器路由 的消息存储起来，而不用返回给客户端

## 1、mandatory

当mandatory参数设为true时，如果交换器无法根据自身的类型和路由键找到一个符合条件的队列，那么RabbitMQ会将消息返回给生产者。当mandatory设置为false时，出现上述情况，则将消息直接丢弃

## 2、immediate

当immediate参数设置为true，时，如果交换器在将消息路由到队列时，发现队列上并不存在任何消费者，那么这条消息将不会存入队列中。当与路邮件匹配的所有队列都没有消费者时，该消息会返回给生产者。

**注:该参数在最新版本的RabbitMQ已经去掉，其增加了代码的复杂度和影响了镜像队列的性能，可以使用TTL或者DLX的方法替代**

## 3、备份交换器

备份交换器可以实现在、将违背路由的消息存储在RabbitMQ中，再在需要的时候去处理这些消息

对于备份交换器，有以下几种特殊情况：

- 如果设置的备份交换器不存在，客户端和RabbitMQ服务端都不会有异常出现，此时消息会丢失
- 如果备份交换器没有绑定任何队列，客户端和RabbitMQ服务端都不会有异常信息，此时消息会丢失
- 如果备份交换器没有任何匹配的队列，客户端和RabbitMQ服务端都不会有异常出现，此时消息会丢失
- 如果备份交换器和mandatory参数一起使用，那么mandatory参数无效

## 4、过期时间

TTL，即过期时间，RabbitMQ可以对消息和队列设置TTL

目前有两种方式设置TTL：

- 通过队列属性设置
- 对消息本身进行单独设置，每条消息的TTL可以不同

如果两种方式一起使用，则消息的TTL以两者之间较小的那个数值为准。